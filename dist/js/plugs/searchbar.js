/*!
 * uwkui
 * Author: lmy
 * Version: 1.0.0
 * Last Update: 2017-01-19 06:03:18
 */
!function(a){"use strict";var b=function(c,d){this.options=a.extend({},b.defaults,d),this.$ele=a(c),this.init()};b.version="1.0.0",b.defaults={searchUrl:"#",matchUrl:"",defvalue:"",getTagsData:{his:function(a,b){},hot:function(a,b){}},onsearch:function(a){console.log("searching："+a)}},b.prototype={init:function(){return this.setDom().bindEvent(),this},setDom:function(){var b=this.options.defvalue?"":"disabled",c='<div class="search-block" ><div class="search-cont"><a class="search-cancel"><i class="icon-back"></i></a><form class="search-inner"><div class="search-item"><i class="search-icon"></i><input value="'+this.options.defvalue+'" class="search-input" placeholder="搜索" type="search" required><i class="search-clear"></i></div></form><a class="search-btn '+b+'">搜索</a></div><div class="search-info"><div class="search-his search-tags s-border-b"></div><div class="search-hot search-tags"></div><div class="search-match"></div></div></div>',d=a(c);return a(document.body).append(d),this.$searchCont=d,this.$cancel=d.find(".search-cancel"),this.$form=d.find("form"),this.$input=d.find("input"),this.$search=d.find(".search-btn"),this.$clear=d.find(".search-clear"),"undefined"==typeof this.$tag&&(this.$tag={}),this.$tag.his=d.find(".search-his"),this.$tag.hot=d.find(".search-hot"),this.$tagsCont=d.find(".search-tags"),this.$matchCont=d.find(".search-match"),this.initTags("his").initTags("hot"),this},bindEvent:function(){var b=this;return b.$ele.on("click",function(){b.$searchCont.show(),b.$input.focus()}),b.$cancel.on("click",function(){b.$searchCont.hide()}),b.$input.on("input",function(){var c=a(this).val();b.options.matchUrl&&b.match(c),""!=c?b.$search.removeClass("disabled"):b.$search.hasClass("disabled")||b.$search.addClass("disabled")}),b.$clear.on("click",function(){b.$input.val("").focus().trigger("input")}),b.$form.on("submit",function(){b.search(b.$input.val())}),b.$search.on("click",function(){b.search(b.$input.val())}),b.$searchCont.on("click",".tag-btn, .match-item",function(){b.search(a(this).text())}),b.$searchCont.on("click",".clear-his",function(){b.clearHisTagData()}),b.$searchCont.on("touchmove",function(){return!1}),this},getTagsDom:function(a){for(var b="",c=a.length,d=0;c>d;d++)b+='<i class="tag-btn">'+a[d]+"</i>";return b},setTags:function(a,b){if(b.length<=0)return this.$tag[a].hide(),this;var c="";return"his"===a?c='<p class="search-title">历史搜索 <small class="clear-his">清空记录</small></p>':"hot"===a&&(c='<p class="search-title">热门搜索</p>'),c+=this.getTagsDom(b),this.$tag[a].html(c).show(),this.tags[a]=b,this},initTags:function(a){var b,c=this;return"undefined"==typeof this.tags&&(this.tags={}),"his"===a&&(b=window.localStorage.getItem("hisTags"),b&&this.setTags("his",b.split(","))),this.options.getTagsData[a](c,function(b){c.setTags(a,b)}),this},addHisTagData:function(a){return a?this.tags.his&&this.tags.his.indexOf(a)>=0?this:(this.tags.his.unshift(a),window.localStorage.setItem("hisTags",this.tags.his.toString()),this):this},clearHisTagData:function(){return this.$tag.his.html("").hide(),this.tags.his=[],window.localStorage.setItem("hisTags",""),this},setMatchsDom:function(a){if(!a)return this;var b="",c=a.length;if(0>=c)return this;for(var d=0;c>d;d++)b+='<div class="match-item s-border-b">'+a[d]+"</div>";return this.$matchCont.html(b),this.$tagsCont.hide(),this.$matchCont.show(),this},getMatch:function(b){if(!b)return this.$tagsCont.show(),this.$matchCont.hide(),this;var c=this;a.ajax({type:"post",data:{value:b},url:c.options.matchUrl,success:function(a){var b=JSON.parse(a);c.setMatchsDom(b.results)}})},match:function(a){var b=this;b.timer&&(clearTimeout(b.timer),b.timer=null),b.timer=setTimeout(function(){b.getMatch(a),b.timer=null},350)},search:function(a){a&&(this.$input.val(a),this.addHisTagData(a),this.options.onsearch(a),window.location.reload())}};var c=a.fn.searchBar;a.fn.searchBar=function(c){return this.each(function(){var d=a(this),e=d.data("scrollLoadData"),f=a.fn.searchBar.pluginData[e],g="object"==typeof c&&c;f||(e=a.fn.searchBar.pluginData.index++,a.fn.searchBar.pluginData[e]=new b(this,g),d.data("searchBarData",e),f=a.fn.searchBar.pluginData[e]),"string"==typeof c&&f[c]()})},a.fn.searchBar.pluginData={index:0},a.fn.searchBar.Constructor=b,a.fn.searchBar.noConflict=function(){return a.fn.searchBar=c,this},a(document).ready(function(){a('[data-role="searchBar"]').each(function(){var b=a(this),c=this.dataset,d=a.trim(b.text());"搜索"===d&&(d=""),c.defvalue=d||"",a.fn.searchBar.call(b,c)})})}($);