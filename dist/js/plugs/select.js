/*!
 * uwkui
 * Author: lmy
 * Version: 1.0.0
 * Last Update: 2017-01-19 06:03:18
 */
!function(a,b){"use strict";var c=function(b,d){return this.opt=a.extend({},c.def,d),this.$ele=a(b),this.init(),this};c.def={title:"请选择",keyWord:"",dom:null,type:"",dataUrl:"",selectData:"",checkedData:"",itemId:"id",itemName:"title",dataName:"data",renderList:"",renderItem:"",defItem:"",isChecked:"",onSelect:function(a,b){},onOpen:function(b){a.popup(b)},onClose:function(b){a.closePopup(b)},onAdd:""},c.prototype={init:function(){this.lock=!1,this.mapData={},this.setDom().getData().bindEvent()},setDom:function(){return this.opt.dom=a(this.opt.dom),this.opt.dom&&0!==this.opt.dom.length||(this.opt.dom=a('<div class="popup"><div class="bar-header bg-wx list-item"><p class="item-inner">'+this.opt.title+'</p><p class="item-after">'+(this.opt.onAdd?'<i class="btn bar-btn btn-mini btn-success j_add">新增</i>':"")+'<i class="btn close_select btn-mini btn-default">取消</i></p></div><div class="content"><ul class="select-list list-cont"></ul></div></div>').appendTo(a["default"].modalCont)),this.opt.domList=this.opt.dom.find(".select-list"),this},isChecked:function(a){var b=this.opt.checkedData,c=this.opt.itemId,d=a[c];return this.opt.isChecked?this.opt.isChecked.call(this,a):b?("object"!=typeof b&&(b=b.split(",")),b.length?b.map(function(a){return a==d||a[c]&&a[c]==d?!0:""}).join(""):b[c]==d):!1},getlistItem:function(a){var b=this.opt.type,c=this.opt.itemId,d=this.opt.itemName,e=this.isChecked(a);return e&&this.select(a),this.opt.renderItem?this.opt.renderItem.call(this,a,e,b):"radio"===b?'<label class="list-item"><p class="item-inner">'+a[d]+'</p><div class="item-after"><input value="'+a[c]+'" '+(e?"checked":"")+' type="radio" class="j_select input-radio" name="radio-select"><i class="uicon-check"></i></div></label>':'<li class="list-item item-link j_select '+(e?"selected":"")+'" data-'+c+'="'+a[c]+'"><i class="item-inner">'+a[d]+"</i></li>"},renderList:function(a){if(a?this.opt.selectData=a:a=this.opt.selectData,this.opt.defItem&&(!a&&(a=[]),a.unshift(this.opt.defItem)),!a||0===a.length)return this.opt.domList.html('<li class="t-center pd-tb-big gray">暂无'+this.opt.keyWord+"数据</li>"),this;var b=this;return this.opt.renderList?this.opt.renderList.call(this,a,this):this.opt.domList.html(a.map(function(a){return b.mapData[a[b.opt.itemId]]=a,b.getlistItem(a)}).join("")),this.delayOpen&&this.open(),this},getData:function(b){if(b&&"object"==typeof b&&("undefined"==typeof b.length?a.extend(this.opt,b):this.opt.selectData=b),this.opt.selectData)return this.renderList();if(this.lock)return this;this.lock=!0;var c=this;return a.loadStart(),a.ajax({type:"post",url:c.opt.dataUrl,complete:function(){a.loadEnd(),c.lock=!1},success:function(b){var d="object"!=typeof b?JSON.parse(b):b;d.errcode?a.toast(d.errmsg):c.renderList(d[c.opt.dataName]||d)},error:function(b,c,d){a.toast(c)}}),this},open:function(a){return this.opt.selectData?(this.delayOpen=!1,a&&this.renderList(),this.opt.onOpen.call(this,this.opt.dom)):this.delayOpen=!0,this},close:function(){return this.opt.onClose.call(this,this.opt.dom),this},select:function(a,b){return a?this.opt.onSelect.call(this,a,b)===!1?!1:(this.opt.checkedData=a,void(a[this.opt.itemName]&&this.$ele.find(".result").text(a[this.opt.itemName]))):this},bindEvent:function(){var b=this;return this.opt.dom.on("click",".close_select",function(){b.close()}).on("click",".j_select",function(){var c=a(this),d=b.opt.dom.find(".j_select.selected"),e="radio"===b.opt.type?c.val():c.data(b.opt.itemId);b.select(b.mapData[e],c)!==!1?(d.removeClass("selected"),c.addClass("selected"),b.close()):"radio"===b.opt.type&&(c[0].checked=!1,d[0]&&(d[0].checked=!0))}).on("click",".j_add",function(){b.opt.onAdd(b)}),this}},a.fn.select=function(b,d){return this.each(function(){var e=a(this),f=e.data("select"),g=a.fn.select.SelectData[f],h="object"==typeof b?b:{};g||(f=a.fn.select.SelectData.index++,g=a.fn.select.SelectData[f]=new c(this,h),e.data("select",f)),"string"==typeof b&&g[b](d)})},a.fn.select.SelectData={index:0},a.fn.select.Constructor=c}($,window);